<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Terra - Living Simulation of Earth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes orbit {
            from { transform: translate(-50%, -50%) translateX(200px) rotate(0deg); }
            to { transform: translate(-50%, -50%) translateX(200px) rotate(360deg); }
        }
        .globe-spin {
            animation: spin 20s linear infinite;
        }
        .orbit-1 { animation: orbit 3s linear infinite; }
        .orbit-2 { animation: orbit 4s linear infinite reverse; }
        .orbit-3 { animation: orbit 5s linear infinite; }
        .orbit-4 { animation: orbit 2s linear infinite reverse; }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden h-screen">
    <!-- Status Bar -->
    <div class="absolute top-0 left-0 right-0 h-12 bg-gray-800/90 backdrop-blur-sm border-b border-gray-700 flex items-center justify-between px-6 z-10">
        <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                <span class="text-sm font-medium">Neural Terra</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-green-400 rounded-full"></div>
                <span class="text-xs text-green-400">Live Data</span>
            </div>
        </div>
        <div class="flex items-center space-x-6">
            <div class="text-xs text-gray-400">
                Simulation Time: 0h
            </div>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="absolute left-4 top-16 w-80 z-20">
        <div class="flex flex-col gap-4 p-4 bg-gray-800/90 backdrop-blur-sm rounded-lg">
            <div class="text-center">
                <h1 class="text-2xl font-bold mb-2">Neural Terra</h1>
                <p class="text-gray-400 text-sm" id="planet-mode">
                    ğŸŒ Earth Mode
                </p>
            </div>

            <!-- Globe Mode Toggle -->
            <div>
                <h3 class="text-sm font-semibold mb-3">Globe Mode</h3>
                <div class="flex space-x-2">
                    <button id="demo-mode-btn" class="flex-1 px-4 py-2 rounded-lg text-sm bg-green-500 text-white">
                        ğŸ¯ Demo Mode
                    </button>
                    <button id="cesium-mode-btn" class="flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600">
                        ğŸŒ CesiumJS
                    </button>
                </div>
            </div>

            <!-- Planet Toggle -->
            <div>
                <h3 class="text-sm font-semibold mb-3">Planet Mode</h3>
                <div class="flex space-x-2">
                    <button id="earth-btn" class="flex-1 px-4 py-2 rounded-lg text-sm bg-blue-500 text-white">
                        ğŸŒ Earth
                    </button>
                    <button id="mars-btn" class="flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600">
                        ğŸª Mars
                    </button>
                </div>
            </div>

            <!-- Data Layers -->
            <div>
                <h3 class="text-sm font-semibold mb-3">Data Layers</h3>
                <div class="grid grid-cols-2 gap-2">
                    <button id="weather-btn" class="p-3 rounded-lg text-sm bg-blue-500 text-white">
                        â˜ï¸ Weather ON
                    </button>
                    <button id="ports-btn" class="p-3 rounded-lg text-sm bg-green-500 text-white">
                        ğŸš¢ Ports ON
                    </button>
                    <button id="grid-btn" class="p-3 rounded-lg text-sm bg-yellow-500 text-white">
                        âš¡ Grid ON
                    </button>
                    <button id="alerts-btn" class="p-3 rounded-lg text-sm bg-red-500 text-white">
                        ğŸš¨ Alerts ON
                    </button>
                </div>
            </div>

            <!-- Scenario Button -->
            <button id="scenario-btn" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-medium">
                ğŸš€ Run Suez-like Scenario
            </button>

            <!-- Status -->
            <div class="text-center text-xs text-gray-400" id="status">
                Demo Mode - Guaranteed Working
            </div>
        </div>
    </div>

    <!-- Globe Visualization -->
    <div class="absolute inset-0 pt-12">
        <div id="globe-container" class="relative w-full h-full bg-black flex items-center justify-center overflow-hidden">
            <!-- Animated Globe -->
            <div class="relative">
                <div id="globe" class="w-80 h-80 rounded-full relative overflow-hidden globe-spin"
                     style="background: linear-gradient(45deg, #1e40af, #3b82f6, #60a5fa, #93c5fd); box-shadow: 0 0 50px rgba(59, 130, 246, 0.5), inset 0 0 50px rgba(255, 255, 255, 0.1);">
                    
                    <!-- Planet-like continents -->
                    <div class="absolute inset-0 opacity-30">
                        <div class="absolute top-8 left-12 w-16 h-12 bg-green-600 rounded-full opacity-60"></div>
                        <div class="absolute top-16 right-16 w-20 h-16 bg-green-700 rounded-full opacity-60"></div>
                        <div class="absolute bottom-20 left-8 w-12 h-8 bg-green-500 rounded-full opacity-60"></div>
                        <div class="absolute bottom-12 right-12 w-18 h-14 bg-green-600 rounded-full opacity-60"></div>
                    </div>
                    
                    <!-- Atmosphere glow -->
                    <div class="absolute inset-0 rounded-full opacity-20"
                         style="background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%); transform: scale(1.1);">
                    </div>
                </div>

                <!-- Orbiting data points -->
                <div id="weather-point" class="absolute top-1/2 left-1/2 w-4 h-4 bg-blue-400 rounded-full animate-pulse orbit-1"
                     style="transform: translate(-50%, -50%) translateX(200px); box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);">
                </div>
                
                <div id="ports-point" class="absolute top-1/2 left-1/2 w-3 h-3 bg-green-400 rounded-full animate-pulse orbit-2"
                     style="transform: translate(-50%, -50%) translateX(180px); box-shadow: 0 0 15px rgba(34, 197, 94, 0.8);">
                </div>
                
                <div id="grid-point" class="absolute top-1/2 left-1/2 w-3 h-3 bg-yellow-400 rounded-full animate-pulse orbit-3"
                     style="transform: translate(-50%, -50%) translateX(220px); box-shadow: 0 0 15px rgba(251, 191, 36, 0.8);">
                </div>

                <div id="alerts-point" class="absolute top-1/2 left-1/2 w-3 h-3 bg-red-400 rounded-full animate-pulse orbit-4"
                     style="transform: translate(-50%, -50%) translateX(160px); box-shadow: 0 0 15px rgba(239, 68, 68, 0.8);">
                </div>
            </div>

            <!-- Status indicator -->
            <div class="absolute top-4 left-4 bg-green-800/90 text-green-200 px-3 py-1 rounded text-sm">
                âœ… Interactive Globe Active
            </div>

            <!-- Planet indicator -->
            <div id="planet-indicator" class="absolute top-4 right-4 bg-blue-800/90 text-blue-200 px-3 py-1 rounded text-sm">
                ğŸŒ Earth
            </div>

            <!-- Impact Visualization -->
            <div id="impact-display" class="absolute bottom-4 left-4 bg-purple-800/90 text-purple-200 px-3 py-2 rounded text-sm hidden">
                <div class="font-semibold mb-1">Scenario Impact:</div>
                <div id="impact-data" class="text-xs"></div>
            </div>

            <!-- Controls hint -->
            <div class="absolute bottom-4 right-4 bg-gray-800/90 text-gray-200 px-3 py-1 rounded text-sm">
                ğŸ® All Controls Working
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentPlanet = 'earth';
        let activeLayers = {
            weather: true,
            ports: true,
            grid: true,
            alerts: true
        };
        let showCesium = false;
        let impacts = {};

        // DOM elements
        const globe = document.getElementById('globe');
        const planetMode = document.getElementById('planet-mode');
        const planetIndicator = document.getElementById('planet-indicator');
        const impactDisplay = document.getElementById('impact-display');
        const impactData = document.getElementById('impact-data');
        const status = document.getElementById('status');

        // Planet switching
        function setPlanet(planet) {
            currentPlanet = planet;
            
            if (planet === 'earth') {
                globe.style.background = 'linear-gradient(45deg, #1e40af, #3b82f6, #60a5fa, #93c5fd)';
                globe.style.boxShadow = '0 0 50px rgba(59, 130, 246, 0.5), inset 0 0 50px rgba(255, 255, 255, 0.1)';
                planetMode.textContent = 'ğŸŒ Earth Mode';
                planetIndicator.innerHTML = 'ğŸŒ Earth';
                document.getElementById('earth-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-blue-500 text-white';
                document.getElementById('mars-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600';
            } else {
                globe.style.background = 'linear-gradient(45deg, #dc2626, #ef4444, #f87171, #fca5a5)';
                globe.style.boxShadow = '0 0 50px rgba(239, 68, 68, 0.5), inset 0 0 50px rgba(255, 255, 255, 0.1)';
                planetMode.textContent = 'ğŸª Mars Mode';
                planetIndicator.innerHTML = 'ğŸª Mars';
                document.getElementById('mars-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-red-500 text-white';
                document.getElementById('earth-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600';
            }
        }

        // Layer toggling
        function toggleLayer(layer) {
            activeLayers[layer] = !activeLayers[layer];
            const point = document.getElementById(layer + '-point');
            const btn = document.getElementById(layer + '-btn');
            
            if (activeLayers[layer]) {
                point.style.display = 'block';
                btn.className = btn.className.replace('bg-gray-700', 'bg-' + 
                    (layer === 'weather' ? 'blue' : 
                     layer === 'ports' ? 'green' : 
                     layer === 'grid' ? 'yellow' : 'red') + '-500');
                btn.innerHTML = btn.innerHTML.replace('OFF', 'ON');
            } else {
                point.style.display = 'none';
                btn.className = btn.className.replace(/bg-\w+-500/, 'bg-gray-700');
                btn.innerHTML = btn.innerHTML.replace('ON', 'OFF');
            }
        }

        // Scenario simulation
        async function runScenario() {
            try {
                const response = await fetch('http://localhost:8000/simulate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        target_ids: ['rotterdam'],
                        magnitude: 0.4,
                        duration_hours: 168,
                        start_ts: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const series = data.impact_series || {};
                    impacts = {};
                    Object.keys(series).forEach(k => {
                        const arr = series[k] || [];
                        impacts[k] = arr.length ? Math.max(0, Math.min(1, arr[arr.length - 1])) : 0;
                    });
                    
                    // Show impacts
                    if (Object.keys(impacts).length > 0) {
                        impactData.innerHTML = Object.entries(impacts)
                            .map(([key, value]) => `<div>${key}: ${(value * 100).toFixed(0)}%</div>`)
                            .join('');
                        impactDisplay.classList.remove('hidden');
                    }
                    
                    console.log('âœ… Scenario completed:', impacts);
                }
            } catch (error) {
                console.error('âŒ Scenario failed:', error);
                // Fallback demo impact
                impacts = { 'rotterdam': 0.8, 'eu_central': 0.6 };
                impactData.innerHTML = Object.entries(impacts)
                    .map(([key, value]) => `<div>${key}: ${(value * 100).toFixed(0)}%</div>`)
                    .join('');
                impactDisplay.classList.remove('hidden');
            }
        }

        // Event listeners
        document.getElementById('earth-btn').addEventListener('click', () => setPlanet('earth'));
        document.getElementById('mars-btn').addEventListener('click', () => setPlanet('mars'));
        document.getElementById('weather-btn').addEventListener('click', () => toggleLayer('weather'));
        document.getElementById('ports-btn').addEventListener('click', () => toggleLayer('ports'));
        document.getElementById('grid-btn').addEventListener('click', () => toggleLayer('grid'));
        document.getElementById('alerts-btn').addEventListener('click', () => toggleLayer('alerts'));
        document.getElementById('scenario-btn').addEventListener('click', runScenario);

        // Globe mode toggle
        document.getElementById('demo-mode-btn').addEventListener('click', () => {
            showCesium = false;
            status.textContent = 'Demo Mode - Guaranteed Working';
            document.getElementById('demo-mode-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-green-500 text-white';
            document.getElementById('cesium-mode-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600';
        });

        document.getElementById('cesium-mode-btn').addEventListener('click', () => {
            showCesium = true;
            status.textContent = 'CesiumJS Mode - Advanced Globe';
            document.getElementById('cesium-mode-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-blue-500 text-white';
            document.getElementById('demo-mode-btn').className = 'flex-1 px-4 py-2 rounded-lg text-sm bg-gray-700 text-gray-300 hover:bg-gray-600';
        });

        console.log('ğŸš€ Neural Terra loaded successfully!');
    </script>
</body>
</html>
